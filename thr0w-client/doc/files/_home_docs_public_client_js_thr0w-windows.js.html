<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/home/docs/public/client/js/thr0w-windows.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/thr0w.html">thr0w</a></li>
            
                <li><a href="../classes/thr0w.draw.html">thr0w.draw</a></li>
            
                <li><a href="../classes/thr0w.FlexGrid.html">thr0w.FlexGrid</a></li>
            
                <li><a href="../classes/thr0w.Grid.html">thr0w.Grid</a></li>
            
                <li><a href="../classes/thr0w.svg.html">thr0w.svg</a></li>
            
                <li><a href="../classes/thr0w.Sync.html">thr0w.Sync</a></li>
            
                <li><a href="../classes/thr0w.windows.html">thr0w.windows</a></li>
            
                <li><a href="../classes/thr0w.windows.WindowManager.html">thr0w.windows.WindowManager</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/thr0w-base.html">thr0w-base</a></li>
            
                <li><a href="../modules/thr0w-draw.html">thr0w-draw</a></li>
            
                <li><a href="../modules/thr0w-svg.html">thr0w-svg</a></li>
            
                <li><a href="../modules/thr0w-windows.html">thr0w-windows</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /home/docs/public/client/js/thr0w-windows.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function() {
  // jscs:disable
  /**
  * This module provides a window manager.
  * @module thr0w-windows
  */
  // jscs:enable
  &#x27;use strict&#x27;;
  var BAR_HEIGHT = 50;
  var BASE_Z = 800;
  if (window.thr0w === undefined) {
    throw 400;
  }
  var service = {};
  service.WindowManager = WindowManager;
  // jscs:disable
  /**
  * This object provides the window management functionality.
  * @namespace thr0w
  * @class windows
  * @static
  */
  // jscs:enable
  window.thr0w.windows = service;
  // jscs:disable
  /**
  * This class is used to create window managers.
  * @namespace thr0w.windows
  * @class WindowManager
  * @constructor
  * @param id {String} The id.
  * @param grid {Object} The grid, {{#crossLink &quot;thr0w.Grid&quot;}}Thr0w.Grid{{/crossLink}}, object.
  */
  // jscs:enable
  function WindowManager(wmId, grid) {
    if (wmId === undefined || typeof wmId !== &#x27;string&#x27;) {
      throw 400;
    }
    if (!grid || typeof grid !== &#x27;object&#x27;) {
      throw 400;
    }
    var windows = [];
    var contentEl = grid.getContent();
    var sync = new window.thr0w.Sync(
      grid,
      &#x27;thr0w_windows_&#x27; + contentEl.id,
      message,
      receive
      );
    this.openWindow = openWindow;
    this.closeWindow = closeWindow;
    function message() {
      var data = [];
      var i;
      for (i = 0; i &lt; windows.length; i++) {
        var iWindow = windows[i];
        data.push({
          id: iWindow.getId(),
          x: iWindow.getX(),
          y: iWindow.getY(),
          width: iWindow.getWidth(),
          height: iWindow.getHeight(),
          src: iWindow.getSrc()
        });
      }
      return data;
    }
    function receive(data) {
      var dataIds = data.map(getDataId);
      var windowIds = windows.map(getWindowId);
      var i;
      var j;
      var w;
      var orderedWindows = [];
      // WINDOW NOT IN DATA
      for (i = 0; i &lt; windows.length; i++) {
        w = windows[i];
        if (dataIds.indexOf(w.getId()) === -1) {
          windows.splice(i, 1);
          w.destroy();
        }
      }
      // DATA NOT IN WINDOWS
      for (i = 0; i &lt; data.length; i++) {
        if (windowIds.indexOf(data[i].id) === -1) {
          windows.push(new WindowFrame(data[i].id, data[i].x,
            data[i].y, data[i].width, data[i].height, data[i].src));
        }
      }
      // RESETTING WINDOWS ORDER
      for (i = 0; i &lt; dataIds.length; i++) {
        for (j = 0; j &lt; windows.length; j++) {
          w = windows[j];
          if (w.getId() === dataIds[i]) {
            w.deactivate();
            orderedWindows.push(w);
            windows.splice(j, 1);
            break;
          }
        }
      }
      windows = orderedWindows;
      stackWindows();
      function getDataId(obj) {
        return obj.id;
      }
    }
    function sendToTop(id) {
      var i;
      var j;
      var w;
      for (i = 0; i &lt; windows.length; i++) {
        windows[i].deactivate();
        if (windows[i].getId() === id) {
          j = i;
          w = windows[i];
        }
      }
      windows.splice(j, 1);
      windows.push(w);
      stackWindows();
      sync.update();
      sync.idle();
    }
    // jscs:disable
    /**
    * This method is used to create windows; max windows = 100;
    * @method openWindow
    * @param id {String} The id.
    * @param x {Integer} The horizontal position; min = 0, max = grid content width - width.
    * @param y {Integer} The vertical position; min = 50px, max = grid content height - height.
    * @param width {Integer} The width; min = 140px.
    * @param height {Integer} The height.
    * @param src {String} The source url.
    */
    // jscs:enable
    function openWindow(id, x, y, width, height, src) {
      if (windows.length &gt; 99) {
        throw 400;
      }
      if (windows.map(getWindowId).indexOf(id) !== -1) {
        throw 400;
      }
      if (id === undefined || typeof id !== &#x27;string&#x27;) {
        throw 400;
      }
      if (x === undefined || typeof x !== &#x27;number&#x27; || x &lt; 0) {
        throw 400;
      }
      if (y === undefined || typeof y !== &#x27;number&#x27; || y &lt; BAR_HEIGHT) {
        throw 400;
      }
      if (width === undefined || typeof width !== &#x27;number&#x27; || width &lt; 140) {
        throw 400;
      }
      if (height === undefined || typeof height !== &#x27;number&#x27;) {
        throw 400;
      }
      if (src === undefined || typeof src !== &#x27;string&#x27;) {
        throw 400;
      }
      if (x + width &gt; grid.getWidth()) {
        throw 400;
      }
      if (y + height + BAR_HEIGHT &gt; grid.getHeight()) {
        throw 400;
      }
      var i;
      for (i = 0; i &lt; windows.length; i++) {
        windows[i].deactivate();
      }
      windows.push(new WindowFrame(id, x, y - BAR_HEIGHT, width,
        height + BAR_HEIGHT, src));
      stackWindows();
      sync.update();
      sync.idle();
    }
    // jscs:disable
    /**
    * This method is used to close windows.
    * @method closeWindow
    * @param id {String} The id.
    */
    // jscs:enable
    function closeWindow(id) {
      if (id === undefined || typeof id !== &#x27;string&#x27;) {
        throw 400;
      }
      var i = windows.map(getWindowId).indexOf(id);
      if (i === -1) {
        throw 400;
      }
      var w = windows[i];
      windows.splice(i, 1);
      w.destroy();
      stackWindows();
      sync.update();
      sync.idle();
      // jscs:disable
      /**
      * Window closed.
      *
      * @event thr0w_windows_close_window 
      * @param {String} wmid The {{#crossLink &quot;thr0w.windows.WindowManager&quot;}}thr0w.windows.WindowManager{{/crossLink}} object&#x27;s id.
      * @param {String} id The window&#x27;s id.
      */
      // jscs:enable
      document.dispatchEvent(new CustomEvent(&#x27;thr0w_windows_close_window&#x27;,
        {detail: {wmid: wmId, id: id}}));
    }
    function getWindowId(obj) {
      return obj.getId();
    }
    function stackWindows() {
      var i;
      for (i = 0; i &lt; windows.length; i++) {
        windows[i].setZ(BASE_Z + i);
      }
      i = windows.length - 1;
      if (i !== -1) {
        windows[i].activate();
      }
    }
    function WindowFrame(id, x, y, width, height, src) {
      var frameEl = grid.getFrame();
      var offsetLeft = frameEl.offsetLeft + contentEl.offsetLeft;
      var offsetTop = frameEl.offsetTop + contentEl.offsetTop;
      var active = true;
      var lastX;
      var lastY;
      var moving = false;
      var scrollX = 0;
      var scrollY = 0;
      var startScrolling = false;
      var endScrolling = true;
      var windowEl = document.createElement(&#x27;div&#x27;);
      var windowBarEl;
      var windowControlsEl;
      var windowControlsCloseEl;
      var windowContentEl;
      var windowCoverEl;
      var windowSync = new window.thr0w.Sync(
        grid,
        &#x27;thr0w_windows_&#x27; + contentEl.id + &#x27;_&#x27; + id,
        windowMessage,
        windowReceive
        );
      windowEl.id = id;
      windowEl.style.left = x + &#x27;px&#x27;;
      windowEl.style.top = y + &#x27;px&#x27;;
      windowEl.style.width = width + &#x27;px&#x27;;
      windowEl.style.height = height + &#x27;px&#x27;;
      windowEl.classList.add(&#x27;thr0w_windows_window&#x27;);
      // jscs:disable
      windowEl.innerHTML = [
        &#x27;&lt;div class=&quot;thr0w_windows_window__bar&quot;&gt;&#x27;,
        &#x27;&lt;div class=&quot;thr0w_windows_window__bar__controls&quot;&gt;&#x27;,
        &#x27;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:svg=&quot;http://www.w3.org/2000/svg&quot; viewbox=&quot;0 0 100 100&quot; class=&quot;thr0w_windows_window__bar__controls__control thr0w_windows_window__bar__controls__control--close&quot;&gt;&#x27;,
        &#x27;&lt;g&gt;&#x27;,
        &#x27;&lt;ellipse stroke=&quot;#cccccc&quot; ry=&quot;49&quot; rx=&quot;49&quot; id=&quot;svg_1&quot; cy=&quot;50&quot; cx=&quot;50&quot; stroke-width=&quot;2&quot; fill=&quot;#ffffff&quot;/&gt;&#x27;,
        &#x27;&lt;path id=&quot;svg_4&quot; fill-opacity=&quot;0.5&quot; stroke-linecap=&quot;null&quot; stroke-linejoin=&quot;null&quot; stroke-dasharray=&quot;null&quot; stroke-width=&quot;2&quot; stroke=&quot;#cccccc&quot; fill=&quot;#cccccc&quot;/&gt;&#x27;,
        &#x27;&lt;path id=&quot;svg_6&quot; d=&quot;m13.75,30.5l18.5,18.75l-19.5,20.25l17.25,16.75l20.5,-19l19.25,19.5l17.25,-17l-19.5,-19.25l19.75,-19.75l-17.5,-17.5l-19.25,20l-19.5,-20l-17.25,17.25z&quot; fill-opacity=&quot;0.5&quot; stroke-linecap=&quot;null&quot; stroke-linejoin=&quot;null&quot; stroke-dasharray=&quot;null&quot; stroke-width=&quot;2&quot; stroke=&quot;#cccccc&quot; fill=&quot;#cccccc&quot;/&gt;&#x27;,
        &#x27;&lt;/g&gt;&#x27;,
        &#x27;&lt;/svg&gt;&#x27;,
        &#x27;&lt;/div&gt;&#x27;,
        &#x27;&lt;/div&gt;&#x27;,
        &#x27;&lt;iframe src=&quot;&#x27; + src + &#x27;&quot; width=&quot;&#x27; + width + &#x27;&quot; height=&quot;&#x27; + (height - BAR_HEIGHT) + &#x27;&quot; frameborder=&quot;0&quot; class=&quot;thr0w_windows_window__content&quot;&gt;&#x27;,
        &#x27;&lt;/iframe&gt;&#x27;,
        &#x27;&lt;div style=&quot;width: &#x27;  + width + &#x27;px; height: &#x27; + (height - BAR_HEIGHT) +&#x27;px;&quot; class=&quot;thr0w_windows_window__cover&quot;&gt;&lt;/div&gt;&#x27;,
      ].join(&#x27;\n&#x27;);
      // jscs:enable
      windowEl.addEventListener(&#x27;mousedown&#x27;, sendSelfToTop);
      windowEl.addEventListener(&#x27;touchstart&#x27;, sendSelfToTop);
      windowBarEl = windowEl.querySelector(&#x27;.thr0w_windows_window__bar&#x27;);
      windowBarEl.addEventListener(&#x27;mousedown&#x27;, startMoving);
      windowBarEl.addEventListener(&#x27;touchstart&#x27;, startMoving);
      windowBarEl.addEventListener(&#x27;mousemove&#x27;, move);
      windowBarEl.addEventListener(&#x27;touchmove&#x27;, move);
      windowBarEl.addEventListener(&#x27;mouseup&#x27;, endMoving);
      windowBarEl.addEventListener(&#x27;mouseleave&#x27;, endMoving);
      windowBarEl.addEventListener(&#x27;touchend&#x27;, endMoving);
      windowBarEl.addEventListener(&#x27;touchcancel&#x27;, endMoving);
      windowControlsEl = windowEl
        .querySelector(&#x27;.thr0w_windows_window__bar__controls&#x27;);
      windowControlsEl.style.visibility = &#x27;visible&#x27;;
      windowControlsCloseEl = windowControlsEl
        .querySelector(&#x27;.thr0w_windows_window__bar__controls__control--close&#x27;);
      windowControlsCloseEl.addEventListener(&#x27;click&#x27;, closeSelf);
      windowContentEl = windowEl
        .querySelector(&#x27;.thr0w_windows_window__content&#x27;);
      windowContentEl.addEventListener(&#x27;load&#x27;, contentLoaded);
      windowCoverEl = windowEl.querySelector(&#x27;.thr0w_windows_window__cover&#x27;);
      windowCoverEl.style.visibility = &#x27;hidden&#x27;;
      contentEl.appendChild(windowEl);
      this.getId = getId;
      this.getX = getX;
      this.getY = getY;
      this.getWidth = getWidth;
      this.getHeight = getHeight;
      this.getSrc = getSrc;
      this.activate = activate;
      this.deactivate = deactivate;
      this.destroy = destroy;
      this.setZ = setZ;
      function windowMessage() {
        return {
          x: x,
          y: y,
          scrollX: scrollX,
          scrollY: scrollY
        };
      }
      function windowReceive(data) {
        x = data.x;
        y = data.y;
        scrollX = data.scrollX;
        scrollY = data.scrollY;
        windowEl.style.left = x + &#x27;px&#x27;;
        windowEl.style.top = y + &#x27;px&#x27;;
        windowContentEl.contentWindow.document.body.scrollTop = scrollX;
        windowContentEl.contentWindow.document.body.scrollLeft = scrollY;
      }
      function sendSelfToTop() {
        sendToTop(id);
      }
      function startMoving(e) {
        moving = true;
        if (e.type === &#x27;mousedown&#x27;) {
          lastX = e.pageX - offsetLeft;
          lastY = e.pageY - offsetTop;
        } else {
          lastX = Math.floor(e.changedTouches[0].pageX) - offsetLeft;
          lastY = Math.floor(e.changedTouches[0].pageY) - offsetTop;
        }
        windowSync.update();
      }
      function move(e) {
        if (!moving) {
          return;
        }
        var currentX;
        var currentY;
        if (e.type === &#x27;mousemove&#x27;) {
          currentX = e.pageX - offsetLeft;
          currentY = e.pageY - offsetTop;
        } else {
          currentX = Math.floor(e.changedTouches[0].pageX) - offsetLeft;
          currentY = Math.floor(e.changedTouches[0].pageY) - offsetTop;
        }
        x = Math.min(x + currentX - lastX, grid.getWidth() - width);
        x = Math.max(x, 0);
        y = Math.min(y + currentY - lastY, grid.getHeight() - height);
        y = Math.max(y, 0);
        windowEl.style.left = x + &#x27;px&#x27;;
        windowEl.style.top = y + &#x27;px&#x27;;
        lastX = currentX;
        lastY = currentY;
        windowSync.update();
      }
      function endMoving() {
        moving = false;
        windowSync.idle();
      }
      function closeSelf() {
        closeWindow(id);
      }
      function contentLoaded() {
        windowContentEl.removeEventListener(&#x27;load&#x27;, contentLoaded);
        windowContentEl.contentWindow.document
          .addEventListener(&#x27;scroll&#x27;, scrolling);
      }
      function getId() {
        return id;
      }
      function getX() {
        return x;
      }
      function getY() {
        return y;
      }
      function getWidth() {
        return width;
      }
      function getHeight() {
        return height;
      }
      function getSrc() {
        return src;
      }
      function setZ(z) {
        windowEl.style.zIndex = z;
      }
      function activate() {
        if (active) {
          return;
        }
        active = true;
        windowCoverEl.style.visibility = &#x27;hidden&#x27;;
        windowControlsEl.style.visibility = &#x27;visible&#x27;;
      }
      function deactivate() {
        if (!active) {
          return;
        }
        active = false;
        windowControlsEl.style.visibility = &#x27;hidden&#x27;;
        windowCoverEl.style.visibility = &#x27;visible&#x27;;
      }
      function destroy() {
        windowEl.removeEventListener(&#x27;mousedown&#x27;, sendSelfToTop);
        windowEl.removeEventListener(&#x27;touchstart&#x27;, sendSelfToTop);
        windowBarEl.removeEventListener(&#x27;mousedown&#x27;, startMoving);
        windowBarEl.removeEventListener(&#x27;touchstart&#x27;, startMoving);
        windowBarEl.removeEventListener(&#x27;mousemove&#x27;, move);
        windowBarEl.removeEventListener(&#x27;touchmove&#x27;, move);
        windowBarEl.removeEventListener(&#x27;mouseup&#x27;, endMoving);
        windowBarEl.removeEventListener(&#x27;mouseleave&#x27;, endMoving);
        windowBarEl.removeEventListener(&#x27;touchend&#x27;, endMoving);
        windowBarEl.removeEventListener(&#x27;touchcancel&#x27;, endMoving);
        windowControlsCloseEl.removeEventListener(&#x27;click&#x27;, closeSelf);
        windowContentEl.contentWindow.location.href = &#x27;about:blank&#x27;;
        contentEl.removeChild(windowEl);
        windowSync.destroy();
      }
      function scrolling() {
        if (!startScrolling) {
          window.setTimeout(checkScrolling, 1000);
          startScrolling = true;
        }
        endScrolling = false;
        scrollX = windowContentEl.contentWindow.document.body.scrollTop;
        scrollY = windowContentEl.contentWindow.document.body.scrollLeft;
        windowSync.update();
        function checkScrolling() {
          if (endScrolling) {
            startScrolling = false;
            windowSync.idle();
          } else {
            endScrolling = true;
            window.setTimeout(checkScrolling, 1000);
          }
        }
      }
    }
  }
})();


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
