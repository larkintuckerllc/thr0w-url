!function(){"use strict";function t(t){v=t}function e(t,e){function n(t){function n(t){t||(o.style.display="none",e())}t.preventDefault();var r=o.querySelector("#thr0w_base_login__username").value,a=o.querySelector("#thr0w_base_login__password").value;r&&a&&i(r,a,n)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(a())return e();var o=document.createElement("form");o.id="thr0w_base_login",o.innerHTML=['<input id="thr0w_base_login__username" type="text" placeholder="Username">','<input id="thr0w_base_login__password" type="password" placeholder="Password">','<button type="submit">Login</button>'].join("\n"),o.addEventListener("submit",n),t.appendChild(o)}function n(t,n,o){function i(){function t(t){function e(t){27===t.keyCode&&y()}t?y():(window.localStorage.setItem("thr0w_channel",c),document.addEventListener("keydown",e),n())}f(c,t,o)}function s(){function e(){r()}function n(t){t.preventDefault(),o.style.display="none",c=parseInt(o.querySelector("#thr0w_base_connect__connect__channel").value),(!c||c<0)&&(c=0),i()}var o=document.createElement("div");o.id="thr0w_base_connect",o.innerHTML=['<form id="thr0w_base_connect__connect">','<input id="thr0w_base_connect__connect__channel" type="number" />','<button type="submit">Connect</button>',"</form>",'<button id="thr0w_base_connect__logout">Logout</button>'].join("\n"),o.querySelector("#thr0w_base_connect__logout").addEventListener("click",e),o.querySelector("#thr0w_base_connect__connect").addEventListener("submit",n),t.appendChild(o)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===n||"function"!=typeof n)throw 400;if(void 0===o||"function"!=typeof o)throw 400;var c=window.localStorage.getItem("thr0w_channel");null!==c?(c=parseInt(c),i()):a()?s():e(t,s)}function o(){return b}function i(t,e,n){function o(){if(4===a.readyState){if(200===a.status){var t;try{t=JSON.parse(a.responseText).token}catch(e){return n(500)}return t?(window.localStorage.setItem("thr0w_token",t),n(null)):n(500)}return n(a.status?a.status:500)}}if(void 0===t||"string"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var i=v+":3000/api/login",r="username="+t+"&password="+e,a=new XMLHttpRequest;a.open("POST",i,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=o,a.send(r)}function r(){window.localStorage.removeItem("thr0w_token"),y()}function a(){return null!==window.localStorage.getItem("thr0w_token")}function s(){return window.localStorage.getItem("thr0w_token")}function c(t,e){function n(){if(4===i.readyState)return 200!==i.status?e(i.status?i.status:500):(window.localStorage.setItem("thr0w_token",t),e(null))}if(void 0===t||"string"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;var o=v+":3000/api/valid",i=new XMLHttpRequest;i.open("POST",o,!0),i.setRequestHeader("Authorization","bearer "+t),i.setRequestHeader("Content-type","application/json"),i.onreadystatechange=n,i.send(JSON.stringify({}))}function l(t,e){var n=v+":3000/api/thr0w",o=window.localStorage.getItem("thr0w_token"),i=new XMLHttpRequest;i.open("POST",n,!0),i.setRequestHeader("Authorization","bearer "+o),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify({channels:t,message:e}))}function f(t,e,n){function o(){m.disconnect(),e(500)}function i(){m.emit("authenticate",JSON.stringify({token:s,channel:b}))}function r(){l||(l=!0,window.clearTimeout(c),m.on("message",n),m.on("duplicate",y),e(null))}var s,c,l=!1;if(!m){if(!a())throw 400;if(void 0===t||"number"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;b=t,s=window.localStorage.getItem("thr0w_token"),c=window.setTimeout(o,5e3),m=_(v+":3001"),m.on("authenticated",r),m.on("reconnect",i),m.emit("authenticate",JSON.stringify({token:s,channel:b}))}}function u(t){if(!a())throw 400;if(null===b)throw 400;if(void 0===t||"function"!=typeof t)throw 400;m.on("message",t)}function h(t){if(!a())throw 400;if(null===b)throw 400;if(void 0===t||"function"!=typeof t)throw 400;m.off("message",t)}function d(t,e){if(!m)throw 400;if(void 0===t||!Array.isArray(t))throw 400;0!==t.length&&m.emit("thr0w",JSON.stringify({channels:t,message:e}))}function w(t,e,n){function o(){return t}function i(){return e}function r(){return n}function a(){return e.clientWidth}function s(){return e.clientHeight}function c(){return 1}function l(e){if(void 0===e||!Array.isArray(e)||2!==e.length||void 0===e[0]||void 0===e[1]||"number"!=typeof e[0]||"number"!=typeof e[1])throw 400;return[e[0]+f*t.clientWidth,e[1]+u*t.clientHeight]}if(!m)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;for(var f=0,u=0,h=0;h<n.length;h++)for(var d=0;d<n[h].length;d++)b===n[h][d]&&(f=d,u=h);e.style.left="-"+f*t.clientWidth+"px",e.style.top="-"+u*t.clientHeight+"px",this.getFrame=o,this.getContent=i,this.getMatrix=r,this.getWidth=a,this.getHeight=s,this.getRowScale=c,this.frameXYToContentXY=l}function g(t,e,n,o){function i(){return t}function r(){return e}function a(){return n}function s(){return g}function c(){return p}function l(){return o[w].scale}function f(t){if(void 0===t||!Array.isArray(t)||2!==t.length||void 0===t[0]||void 0===t[1]||"number"!=typeof t[0]||"number"!=typeof t[1])throw 400;return[t[0]*o[w].scale+y,t[1]*o[w].scale+v]}if(!m)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;if(void 0===o||!Array.isArray(o))throw 400;var u,h,d=0,w=0,g=0,p=0,y=0,v=0;for(u=0;u<n.length;u++)for(o[u].spacing=o[u].spacing?o[u].spacing:0,o[u].scale=o[u].scale?o[u].scale:1,o[u].padding=o[u].padding?o[u].padding:0,o[u].margin=o[u].margin?o[u].margin:0,g=Math.max(o[u].scale*o[u].width*n[u].length+2*o[u].padding*o[u].scale+o[u].spacing*(n[u].length-1)*o[u].scale,g),p+=o[u].scale*o[u].height+o[u].scale*o[u].margin,h=0;h<n[u].length;h++)b===n[u][h]&&(d=h,w=u);for(t.style.width=o[w].scale*o[w].width+"px",t.style.height=o[w].scale*o[w].height+"px",t.style.transform="translate("+o[w].width*(1-o[w].scale)/2+"px,"+o[w].height*(1-o[w].scale)/2+"px) scale("+1/o[w].scale+", "+1/o[w].scale+")",e.style.width=g+"px",e.style.height=p+"px",u=0;u<w;u++)v+=o[u].scale*o[u].height+o[u].scale*o[u].margin;var _=o[w].padding*o[w].scale,S=d*o[w].scale*o[w].width,k=d*o[w].spacing*o[w].scale;y=_+S+k,e.style.left="-"+y+"px",e.style.top="-"+v+"px",this.getFrame=i,this.getContent=r,this.getMatrix=a,this.getWidth=s,this.getHeight=c,this.getRowScale=l,this.frameXYToContentXY=f}function p(t,e,n,o,i){function r(){w||(h||(h=!0,g=!0,i&&(y.style.visibility="visible"),d(u,{thr0w:{type:"sync",_id:e,lock:!0}})),d(u,{thr0w:{type:"sync",_id:e,message:n()}}))}function a(){w||(h=!1,i&&(y.style.visibility="hidden"),d(u,{thr0w:{type:"sync",_id:e,unlock:!0}}))}function s(t){var i=t.message;if(void 0!==i&&t.source!==b){var r=i.thr0w;if(void 0!==r&&"sync"===r.type&&r._id===e){if(r.hello)return h&&d(u,{thr0w:{type:"sync",_id:e,lock:!0}}),void(g&&d(u,{thr0w:{type:"sync",_id:e,message:n()}}));if(!h)return r.lock&&!h?(g=!1,w=!0,void(y.style.visibility="visible")):r.unlock&&!h?(w=!1,void(y.style.visibility="hidden")):void o(r.message)}}}function c(){v.removeChild(y),m.off("message",s)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;if(void 0===o||"function"!=typeof o)throw 400;if(void 0!==i&&"boolean"!=typeof i)throw 400;var l,f,u=[],h=!1,w=!1,g=!1,p=t.getMatrix(),y=document.createElement("div"),v=t.getFrame();y.id="thr0w_base_cover--"+e,y.classList.add("thr0w_base_cover"),y.style.visibility="hidden",v.appendChild(y);for(var _=0;_<p.length;_++)for(var S=0;S<p[_].length;S++)u.push(p[_][S]),b===p[_][S]&&(l=S,f=_);m.on("message",s),d(u,{thr0w:{type:"sync",_id:e,hello:!0}}),this.update=r,this.idle=a,this.destroy=c}function y(){window.localStorage.removeItem("thr0w_channel",b),window.location.reload()}var v,_=window.io,m=null,b=null,S={};S.setBase=t,S.addLoginTools=e,S.addAdminTools=n,S.getChannel=o,S.login=i,S.logout=r,S.authenticated=a,S.getToken=s,S.loginToken=c,S.thr0w=l,S.connect=f,S.onMessage=u,S.offMessage=h,S.thr0wChannel=d,S.Grid=w,S.FlexGrid=g,S.Sync=p,window.thr0w=S}();